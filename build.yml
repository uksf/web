trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '10.x'
    displayName: 'Install Node.js'

  - script: |
      npm install -g @angular/cli
      npm install
    displayName: 'npm install'

  - script: |
      node --max-old-space-size=12228 ./node_modules/@angular/cli/bin/ng build --prod --aot --build-optimizer
    displayName: 'ng build'

  - task: ArchiveFiles@2
    displayName: 'Zip Web Artifact'
    inputs:
      rootFolderOrFile: '$(Build.BinariesDirectory)/dist'
      includeRootFolder: false
      archiveType: 'zip'
      archiveFile: '$(Build.ArtifactStagingDirectory)/UKSF.Web.zip'
      replaceExistingArchive: true

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact'
    inputs:
      PathtoPublish: '$(build.artifactstagingdirectory)/UKSF.Web.zip'
      ArtifactName: 'UKSF.Web'
      publishLocation: 'Container'
